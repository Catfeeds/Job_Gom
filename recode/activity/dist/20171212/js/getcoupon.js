"use strict";var Toast=function(t,o){this.msg=t,this.dom=this.createToast(),this.setContent(t),this.hide(o)};Toast.prototype={constructor:Toast,createToast:function(){var t=$('<div style="position:fixed;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);background:rgba(0,0,0,.7);fomt-size:12px;color:#fff;border:1px #000 solid;padding:10px;max-width:50%;">爱爱所大多</div>');return $("body").append(t),t[0]},setContent:function(t){return this.dom.innerHTML=t,this},setSize:function(t,o){},resetSize:function(t,o){},show:function(t){return this.dom.style.display="-webkit-box;",this.dom.style.display="-webkit-flex;",this.dom.style.display="flex","function"==typeof t&&t.apply(this,arguments),this},hide:function(t,o){var i=this;return setTimeout(function(){i.dom.style.display="none"},1e3*t),"function"==typeof o&&o.apply(this,arguments),this}};var Double12={init:function(){this.firstCode=0,this.toastTime=3,this.data={},this.pageCoupon=$("#page-coupon"),this.pageCouponSuccess=$("#page-coupon-success"),this.hintPop=$("#vericode"),this.bind()},bind:function(){var t=this,o=this.pageCoupon,i=this.hintPop;o.on("click",'[node-data="back"]',function(){history.back()}),o.on("click",'[data-node="coupon"]',function(){t.popVeriCode($(this))}),$("#curityimg").on("click",this.getVericode.bind(this)),i.on("click",'[data-node="confirm"]',this.confirmGetCoupon.bind(this)),i.on("click",'[data-node="cancel"]',this.closeVeriCode.bind(this)),$("#goback").on("click",function(){window.location.href=window.location.href})},popVeriCode:function(t){this.data.couponId=t.attr("data-couponid"),this.data.couponParam=t.attr("data-couponparam"),this.data.couponMoney=t.attr("data-money"),this.getVericode()},getVericode:function(){var t=this;$.ajax({url:"/api/getCaptcha",type:"post",data:{couponParam:this.data.couponParam,couponId:this.data.couponId},dataType:"json",success:function(o){200==o.code?(t.hintPop.removeClass("hide"),$("#curityimg").attr("src",o.data.captchaImgUrl+"_&"+Date.now())):t.getCouponFail(o.message)},error:function(t){}})},confirmGetCoupon:function(){this.getCoupon(),this.closeVeriCode()},closeVeriCode:function(){this.hintPop.addClass("hide"),$("#curitytext").val("")},getCoupon:function(){var t=this,o=$.trim($("#curitytext").val());""!==o&&$.ajax({url:"/api/receiveCoupon",type:"post",data:{couponId:this.data.couponId,couponParam:this.data.couponParam,authCode:o,money:this.data.couponMoney},success:function(o){"200"==o.code?t.getCouponSuccess(t.data.couponId):t.getCouponFail(o.message)},error:function(o){t.getCouponFail("领取失败")}})},getCouponSuccess:function(t){var o=this.pageCouponSuccess;this.pageCoupon.addClass("hide"),o.removeClass("hide"),o.find("[data-conponid]").addClass("hide"),o.find('[data-conponid="'+t+'"]').removeClass("hide")},getCouponFail:function(t){this.toast?this.toast.setContent(t).show().hide(this.toastTime):this.toast=new Toast(t,this.toastTime)}};Double12.init();