"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};$(function(){var e={init:function(){this.pageIndex=$("#page-index"),this.pageSendWarm=$("#page-send-warm"),this.pageSendSuccess=$("#page-send-success"),this.pageSendFail=$("#page-send-fail"),this.score=0,this.time=12,this.retryTime=0,this.isFirst=!0,this.isInScale=!1,this.bind()},bind:function(){var e=this;this.pageIndex.on("click",'[data-node="send-warm"]',this.gotoSendWarmPage.bind(this)),this.pageSendWarm.on("touchstart",'[data-node="send-warm"]',function(t){e.startSendWarm(t)}),$(document).on("touchmove",function(t){e.moveSendWarm(t)}),$(document).on("touchend",function(t){e.endSendWarm(t)}),this.bury()},bury:function(){(localStorage.getItem("score"+$GLOBAL_CONFIG.taUserId)||0)>0?this.pageSendSuccess.on("click",'[data-node="seekWarm"]',function(){gomeClicki("send","event","resultpage","give","index"),window.location.href=$(this).attr("data-link")}).on("click",'[data-node="goMain"]',function(){gomeClicki("send","event","resultpage","give","play"),window.location.href=$(this).attr("data-link")}):this.pageSendSuccess.on("click",'[data-node="seekWarm"]',function(){gomeClicki("send","event","resultpage","without","index"),window.location.href=$(this).attr("data-link")}).on("click",'[data-node="goMain"]',function(){gomeClicki("send","event","resultpage","without","play"),window.location.href=$(this).attr("data-link")})},gotoSendWarmPage:function(){this.pageIndex.addClass("hide"),this.pageSendWarm.removeClass("hide"),gomeClicki("send","pageview",{location:"warm-b2"}),this.startTimer()},startSendWarm:function(e){var t=e.touches[0];this.initPosition={x:t.pageX,y:t.pageY},this.isInScale=!0},moveSendWarm:function(e){if(this.isInScale){e.preventDefault();var t=this.pageSendWarm,i=e.touches[0],n=i.pageX,a=i.pageY,o=t.find('[data-node="send-warm"]'),s=t.find('[data-node="thermograph"]'),r={height:o.height(),top:o.offset().top};s.css("-webkit-transition","all .2s linear"),a>r.top&&a<r.top+r.height&&(Math.abs(n-this.initPosition.x)>100||Math.abs(a-this.initPosition.y)>100)&&(this.first||(this.first=!0,t.find('[data-node="figure"]').addClass("hide"),t.find('[data-node="gif"]').removeClass("hide"),t.find('[data-node="gif"] img').attr("src",t.find('[data-node="gif"] img').attr("src"))),this.score<40&&(this.score+=5,this.initPosition={x:i.pageX,y:i.pageY},s.css("bottom",this.score/40*100+"%")))}},endSendWarm:function(e){this.isInScale=!1},startTimer:function(){var e=this,t=this.pageSendWarm.find('[data-node="time"]');this.timerId=setInterval(function(){if(t.text(--e.time),0==e.time){clearInterval(e.timerId);var i=e.score;if("object"===("undefined"==typeof localStorage?"undefined":_typeof(localStorage)))try{localStorage.setItem("score"+$GLOBAL_CONFIG.taUserId,i)}catch(e){console.log("当前为无痕模式，无法保存本地数据")}e.postScore(i),e.gotoSendWarmResult(i)}},1e3)},postScore:function(e){var t=this;$.ajax({url:"/api/incrWarm",type:"post",headers:{"Source-Mark-Type":this.getCookie($GLOBAL_CONFIG.cookie_prefix+"content_ctag_type")||""},data:{userStr:$GLOBAL_CONFIG.taUserStr,warmNum:e,userId:$GLOBAL_CONFIG.taUserId},success:function(i){"200"==i.code?t.retryTime=0:t.rePostScore(e)},error:function(i){t.rePostScore(e)}})},rePostScore:function(e){this.retryTime>1||(this.retryTime++,this.postScore(e))},gotoSendWarmResult:function(e){e>0?this.gotoSendWarmSuccessPage(e):this.gotoSendWarmFailPage()},gotoSendWarmSuccessPage:function(e){var t=this.pageSendSuccess,i=e+$GLOBAL_CONFIG.totalScore,n=t.find('[data-node="total-notice"]'),a=t.find('[data-node="total-coupon"]');if(this.pageSendWarm.addClass("hide"),t.removeClass("hide"),t.find('[data-node="rise-score"]').text(e),i<150?n.html('好友当前暖心值为：<span class="now">'+i+"</span>"):i>=150&&i<=1e4?n.html('好友暖心值已爆表：<span class="now">'+i+"</span>"):i>1e4&&n.html('好友暖心值已爆表：<span class="now">10000+</span>'),i>=50){var o=0;i>=50&&i<100?o=2:i>=100&&i<150?o=5:i>=150&&(o=121),a.show().find("span").text(o)}},gotoSendWarmFailPage:function(){this.pageSendWarm.addClass("hide"),this.pageSendFail.removeClass("hide"),gomeClicki("send","pageview",{location:"warm-b3"})},getCookie:function(e){var t=e+"=([^;]+);?";return new RegExp(t).test(document.cookie),RegExp.$1}};window.addEventListener("load",function(){e.init()},!1)});