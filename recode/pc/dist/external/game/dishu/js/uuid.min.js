"use strict";function uuid1(){for(var o=[],t="0123456789abcdef",e=0;e<36;e++)o[e]=t.substr(Math.floor(16*Math.random()),1);return o[14]="4",o[19]=t.substr(3&o[19]|8,1),o[8]=o[13]=o[18]=o[23]="-",o.join("")}function uuid2(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(o){var t=16*Math.random()|0;return("x"==o?t:3&t|8).toString(16)})}function uuid3(){function o(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return o()+o()+"-"+o()+"-"+o()+"-"+o()+"-"+o()+o()+o()}function uuid4(o,t){var e,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),a=[];if(t=t||i.length,o)for(e=0;e<o;e++)a[e]=i[0|Math.random()*t];else{var n;for(a[8]=a[13]=a[18]=a[23]="-",a[14]="4",e=0;e<36;e++)a[e]||(n=0|16*Math.random(),a[e]=i[19==e?3&n|8:n])}return a.join("")}function GetQueryString(o){var t=new RegExp("(^|&)"+o+"=([^&]*)(&|$)","i"),e=window.location.search.substr(1).match(t);return null!=e?unescape(e[2]):null}function start(){if(""==promId)return $("#popCommonWindow .info").html("").html("对不起，活动已结束"),windowObj.layerShow("nobj","popCommonWindow"),!1;windowObj.closeLayer("popCaptchaWindow");var o=$("#captchaCode").val();$.ajax({url:"//hd.gome.com.cn/promotion/coupons/getCoupons.do",type:"get",dataType:"jsonp",contentType:"text/html;charset=UTF-8",data:"promId="+promId+"&captchaCode="+o+"&uuid="+uuid+"&cps="+cpsCode+"&activityDescription="+encodeURI(activityDescription),error:function(o,t,e){alert("系统繁忙，请稍后再试。")},success:function(o){if("success"!=o.state){if("no_login"==o.state)return void popLogin();if("no_promid"==o.state)$("#popCommonWindow .info").html("").html("对不起，活动已结束");else if("end"==o.state)$("#popCommonWindow .info").html("").html("对不起，活动已结束");else if("user_exception"==o.state)$("#popCommonWindow .info").html("").html("用户存在异常");else if("failed"==o.state)$("#popCommonWindow .info").html("").html("对不起，优惠券领取失败，请稍后再试");else if("no_start"==o.state)$("#popCommonWindow .info").html("").html("活动尚未开始");else if("no_mobile"==o.state)$("#popCommonWindow .info").html("").html('您的手机未激活，暂时不能领取优惠券,<a href="javascript:void(0)" onclick="jhsj()">点此激活</a>');else if("user_no_count"==o.state)$("#popCommonWindow .info").html("").html("对不起，您已不能再领取此优惠券");else if("Integral_problem"==o.state)$("#popCommonWindow .info").html("").html("您的积分不足");else if("coupon_empty"==o.state)$("#popCommonWindow .info").html("").html("对不起，您领取的优惠券已发送完，谢谢参与");else{if("captcha_empty"==o.state)return clickCapt(),$("#captchaCode").val(""),$("#captchaCodeTip").html("请输入验证码"),void windowObj.layerShow("nobj","popCaptchaWindow");if("captcha_error"==o.state)return clickCapt(),$("#captchaCode").val(""),$("#captchaCodeTip").html("验证码错误"),void windowObj.layerShow("nobj","popCaptchaWindow");if("captcha_outtime"==o.state)return clickCapt(),$("#captchaCode").val(""),$("#captchaCodeTip").html("验证码超时"),void windowObj.layerShow("nobj","popCaptchaWindow")}}else{if("success"!=o.state)return void alert("异常情况:"+o.state);$("#popCommonWindow .info").html("").html("优惠券领取成功，信息如下："+o.data+',请您1分钟后去“<a href="javascript:void(0)" onclick="myaccount()" > 我的国美 </a>”查询。')}windowObj.layerShow("nobj","popCommonWindow")}})}function jhsj(){window.location.href="//g.gome.com.cn/ec/homeus/myaccount/accountSecurity.jsp"}function myaccount(){window.location.href="//g.gome.com.cn/ec/homeus/myaccount/gomeMyCoupon.jsp?"+encodeURIComponent("selpage=优惠券&firstMenu=2")}function popLogin(){g$("header",function(){var o=this;g.login(function(){console.log(o),start()})})}function fetchcoupon(o){promId=o,start()}function captchaLoad(){$("#captchaImage").attr("src","//imgcode.gome.com.cn/getimage.no?type=gome_sale_activities&capCd="+uuid+"&r="+Math.random())}function clickCapt(){var o="//imgcode.gome.com.cn/getimage.no?type=gome_sale_activities&capCd="+uuid+"&r="+Math.random();$("#captchaLoad").html('<img title="点击刷新" gome-src="" src='+o+' id="codeRefreshControlCenter" class="codeRefreshControlCenter" onclick="clickCapt()"></img>')}function showCaptchaTip(o){$("#captcha").val(""),clickCapt(),$("#captchaCode").attr("class","pw-txt pw-short J_txt pw-focus err"),$("#captchaCodeTip").addClass("err-tips"),$("#captchaSucc").removeClass("suc-icon"),$("#captchaCodeTip").html('<i></i><div class="msg-cont">'+o+"</div>")}function captchaBlur(){return 4==$("#captchaCode").val().length?($("#captchaCodeTip").html(""),$("#captchaSucc").addClass("suc-icon check-icon"),!0):($("#captchaCode").val(""),$("#captchaCodeTip").html("验证码错误"),!1)}function handleFocus(o){$("#"+o).removeClass("err"),$("#"+o+"Tip").removeClass("err-tips"),$("#"+o+"Succ").removeClass("suc-icon"),$("#"+o+"Tip").html('<i></i><div class="msg-cont">请输入图片中的4位字符，不区分大小写</div>')}var windowObj={layerShow:function(o,t){var e=$.browser.msie,i=e&&$.browser.version<7;!$("#Overlay").length>0&&(i?($("html").css({height:"100%"}),$("body").css({height:"100%"}),$("body").append("<div class='overlay' id='Overlay'><iframe  frameborder=0 id='frame1' style='filter:alpha(opacity=10);opacity: 0.6;height:100%;width:100%;'></iframe></div>")):$("body").append("<div id='Overlay' style='background:#000;cursor: pointer;display: block;filter:alpha(opacity=60);opacity: 0.6;height:100%;width:100%; position: fixed; left: 0;top: 0;z-index:9999998'></div>")),$("#Overlay").show();var a=$("#"+t),n=(document.documentElement.clientHeight-a.height())/2,c=(document.documentElement.clientWidth-a.width())/2;i?(a.css("position","absolute").show(),a.addClass("chagetop")):a.css("top",n).css("left",c).css("position","fixed").css("z-index","9999999").show()},layerShow2:function(o,t,e,i){var a=$.browser.msie,n=a&&$.browser.version<7;!$("#Overlay").length>0&&(n?($("html").css({height:"100%"}),$("body").css({height:"100%"}),$("body").append("<div class='overlay' id='Overlay'><iframe  frameborder=0 id='frame1' style='filter:alpha(opacity=10);opacity: 0.6;height:100%;width:100%;'></iframe></div>")):$("body").append("<div id='Overlay' style='background:#000;cursor: pointer;display: block;filter:alpha(opacity=60);opacity: 0.6;height:100%;width:100%; position: fixed; left: 0;top: 0;z-index:9999998'></div>")),$("#Overlay").show();var c=$("#"+t);void 0===i&&(i="0"),void 0===e&&(e="0");var r=(document.documentElement.clientHeight-c.height())/2-parseInt(e),s=(document.documentElement.clientWidth-c.width())/2-parseInt(i);n?(c.css("position","absolute").show(),c.addClass("chagetop")):c.css("top",r).css("left",s).css("position","fixed").css("z-index","9999999").show()},closeLayer:function(o){$("#"+o).hide(),$("#Overlay").hide()}},cpsCode=GetQueryString("param"),activityDescription=document.title,uuid=uuid1(),promId="";