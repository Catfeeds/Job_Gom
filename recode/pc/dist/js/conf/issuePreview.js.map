{"version":3,"sources":["webpack:///issuePreview.js","webpack:///./src/js/page/issuePreview/index.js"],"names":["webpackJsonp","module","exports","__webpack_require__","$","$_CONFIG","fillComponents","arr","nodes","ue","document","body","children","pushDiv","tagNode","_childNodes","childNodes","data","i","length","_self","attributes","nodeValue","JSON","parse","push","type","text","id","shopId","kid","pushImg","node","src","srcExec","regs","domain","exec","url","pushText","_text","trim","replace","wrapP","tagHtml","innerHTML","arrs","split","img","_arr","cursor","indexOf","_arrs","br","j","tagName","outerHTML","makeFormData","name","val","groupId","attr","components","richText","getContent","formCheck","title","content","checkContent","str","regtxt","reg","test","alert","btnPublishTopic","finished","publishTopic","option","_data","btnDisabled","fetch","post","get","done","success","window","noAlertMessage","setTimeout","location","href","group_domain","unsuccessful","init","btnActivate","fail","ok","html","css","on","e","preventDefault","formData","confirm","okCls","validate","groupid","imid","code","status","message","call"],"mappings":"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","file":"issuePreview.js","sourcesContent":["webpackJsonp([11],[\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t/* WEBPACK VAR INJECTION */(function($, $_CONFIG) {\"use strict\";\n\t\n\t//组装数据\n\tvar fillComponents = function fillComponents(arr) {\n\t    var nodes = ue.document.body.children;\n\t    //push数据到 components\n\t\n\t    var pushDiv = function pushDiv(tagNode) {\n\t        var _childNodes = tagNode.childNodes;\n\t        var data = \"\";\n\t        for (var i = 0; i < _childNodes.length; i++) {\n\t            var _self = _childNodes[i].attributes;\n\t            if (_self) {\n\t                data = _self['data-info'].nodeValue;\n\t                break;\n\t            }\n\t        }\n\t        // var data = _childNodes[i].attributes['data-info'].nodeValue;\n\t        data = JSON.parse(data);\n\t        arr.push({\n\t            \"type\": data.type,\n\t            \"text\": \"\",\n\t            \"id\": data.id,\n\t            \"shopId\": data.shopId,\n\t            \"kid\": data.kid\n\t        });\n\t    };\n\t\n\t    var pushImg = function pushImg(node) {\n\t        var src = \"\",\n\t            srcExec = regs.src,\n\t            domain = srcExec.exec(node)[1];\n\t\n\t        if (domain) {\n\t            src = domain + srcExec.exec(node)[2];\n\t            arr.push({\n\t                \"type\": \"image\",\n\t                \"text\": \"\",\n\t                \"url\": src\n\t            });\n\t        }\n\t    };\n\t\n\t    var pushText = function pushText(text) {\n\t        var _text = $.trim(text).replace(/&nbsp;/gi, ' ');\n\t        if (_text != \"\") {\n\t            arr.push({\n\t                \"type\": \"text\",\n\t                \"text\": _text\n\t            });\n\t        }\n\t    };\n\t    //主体标签事件\n\t\n\t    var wrapP = function wrapP(tagNode) {\n\t        // var childNodes = tagNode.childNodes;\n\t        var tagHtml = tagNode.innerHTML;\n\t\n\t        var arrs = tagHtml.split(regs.img);\n\t\n\t        for (var i = 0; i < arrs.length; i++) {\n\t            var _arr = arrs[i].replace(regs.cursor, '');\n\t            //图片\n\t            if (_arr.indexOf('<img') !== -1) {\n\t\n\t                pushImg(_arr);\n\t\n\t                //文本\n\t            } else if (_arr.indexOf('<br') !== -1) {\n\t                //带有br\n\t                var _arrs = _arr.split(regs.br);\n\t                for (var j = 0; j < _arrs.length; j++) {\n\t                    var _text = _arrs[j];\n\t                    if (_text.indexOf('<br') == -1) {\n\t                        pushText(_text);\n\t                    }\n\t                }\n\t            } else {\n\t                pushText(_arr);\n\t            }\n\t        }\n\t    };\n\t\n\t    //遍历body下的节点 目前只有P 和DIV,img,text(text的为火狐标签溢出bug)\n\t    for (var i = 0; i < nodes.length; i++) {\n\t        var tagNode = nodes[i];\n\t\n\t        var tagName = tagNode.tagName;\n\t\n\t        switch (tagName) {\n\t            case \"P\":\n\t                wrapP(tagNode);\n\t                break;\n\t            case \"DIV\":\n\t                pushDiv(tagNode);\n\t                break;\n\t            case \"IMG\":\n\t                pushImg(tagNode.outerHTML);\n\t                break;\n\t            case \"#TEXT\":\n\t                pushText(tagNode.nodeValue);\n\t                break;\n\t        }\n\t    }\n\t};\n\t\n\tvar makeFormData = function makeFormData() {\n\t    var name = $('[data-node=topicTitle]').val();\n\t    // var content = $('[data-node=editor]').val();\n\t    var groupId = $('[data-action=selectGroup]').attr('data-groupid');\n\t    var components = [];\n\t\n\t    // 转换内容数据 使用ue里面的数据，注释 之前textarea使用的数据\n\t    fillComponents(components);\n\t    /*\n\t    var inputList = $('[data-node=picAndShop]').find('textarea[data-action=textBox]');\n\t    $.each(inputList, function(i, n) {\n\t        components.push($(n).data('info'));\n\t    });\n\t    */\n\t    return {\n\t        \"name\": name,\n\t        \"groupId\": groupId,\n\t        \"components\": components,\n\t        \"richText\": ue.getContent()\n\t    };\n\t};\n\t\n\t//表单检测\n\tvar formCheck = function formCheck() {\n\t    //标题\n\t    var title = $('[data-node=topicTitle]').val();\n\t    //var content = $('[data-node=editor]').val();\n\t    var content = ue.getContent();\n\t    //群组ID\n\t    var groupId = $('[data-action=selectGroup]').attr('data-groupid');\n\t\n\t    var checkContent = function checkContent(str) {\n\t        var regtxt = /(<img|<div)/;\n\t        var reg = /(<p>|<\\/p>|<br>|<br\\/>|&nbsp;| )/gi;\n\t\n\t        if (regtxt.test(str) == true) {\n\t            return false;\n\t        }\n\t\n\t        if (str.replace(reg, \"\") == \"\") {\n\t            return true;\n\t        }\n\t    };\n\t\n\t    if ($.trim(title) === '') {\n\t        alert('请输入话题标题');\n\t        return false;\n\t    }\n\t    if (checkContent(content)) {\n\t        alert('话题内容不能为空');\n\t        return false;\n\t    }\n\t    if ($.trim(groupId) === '') {\n\t        alert('圈子不能为空');\n\t        return false;\n\t    }\n\t    return true;\n\t};\n\t//提交发布话题\n\tvar btnPublishTopic = $('[data-action=publishTopic]');\n\tvar finished = true;\n\tvar publishTopic = function publishTopic(option) {\n\t    var _data = option;\n\t    btnDisabled(btnPublishTopic);\n\t    fetch.post(url.get('groupPublishTopic'), {\n\t        data: _data\n\t    }).done(function (data) {\n\t        if (data.success === true) {\n\t            window.noAlertMessage = 1;\n\t            setTimeout(function () {\n\t                window.location.href = $_CONFIG.group_domain + \"topic/detail?tid=\" + data.data.id + '&no_next=1';\n\t            }, 100);\n\t        } else {\n\t            unsuccessful.init(data);\n\t            btnActivate(btnPublishTopic);\n\t        }\n\t    }).fail(function () {\n\t        btnActivate(btnPublishTopic);\n\t        alert('发送失败，点击确定重新发布', {\n\t            ok: function ok() {\n\t                publishTopic(_data);\n\t            }\n\t        });\n\t    });\n\t};\n\tvar btnDisabled = function btnDisabled(node) {\n\t    finished = false;\n\t    node.html('发布中').css('background-color', '#d0d0d0');\n\t};\n\tvar btnActivate = function btnActivate(node) {\n\t    finished = true;\n\t    node.html('发布').css('background-color', '#f95353');\n\t};\n\tbtnPublishTopic.on('click', function (e) {\n\t    e.preventDefault();\n\t    if (formCheck()) {\n\t        var formData = makeFormData();\n\t        var type = $('[data-action=selectGroup]').attr('data-grouptype');\n\t        if (type == 2) {\n\t            confirm('加入圈子后才能发布话题，确定要加入吗？', {\n\t                okCls: 'pc-btn',\n\t                ok: function ok() {\n\t                    fetch.post(url.get('joinCircle'), {\n\t                        validate: true,\n\t                        data: {\n\t                            groupid: $('[data-action=selectGroup]').attr('data-groupid'),\n\t                            imid: 'b_' + $_CONFIG['userId']\n\t                        }\n\t                    }).done(function (data /*, textStatus, jqXHR*/) {\n\t                        if (data && data.code === 200 && data.success) {\n\t                            if (data.data.status === 0) {\n\t                                confirm('是否确认发布？', {\n\t                                    okCls: '',\n\t                                    ok: function ok() {\n\t                                        if (finished) {\n\t                                            publishTopic(formData);\n\t                                        } else {\n\t                                            // LEEROY JEEEEEEENKIIIIIIIIIIIIIIINS！\n\t                                        }\n\t                                    }\n\t                                });\n\t                            }\n\t                        } else {\n\t                            alert(data.message);\n\t                        }\n\t                    });\n\t                }\n\t            });\n\t        } else {\n\t            confirm('是否确认发布？', {\n\t                okCls: '',\n\t                ok: function ok() {\n\t                    if (finished) {\n\t                        publishTopic(formData);\n\t                    } else {\n\t                        // LEEROY JEEEEEEENKIIIIIIIIIIIIIIINS！\n\t                    }\n\t                }\n\t            });\n\t        }\n\t    }\n\t});\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(3)))\n\n/***/ })\n]);\n\n\n// WEBPACK FOOTER //\n// issuePreview.js","\n//组装数据\nvar fillComponents = function(arr) {\n    var nodes = ue.document.body.children;\n    //push数据到 components\n\n    var pushDiv = function(tagNode) {\n        var _childNodes = tagNode.childNodes;\n        var data = \"\";\n        for (var i = 0; i < _childNodes.length; i++) {\n            var _self = _childNodes[i].attributes;\n            if (_self) {\n                data = _self['data-info'].nodeValue;\n                break;\n            }\n\n        }\n        // var data = _childNodes[i].attributes['data-info'].nodeValue;\n        data = JSON.parse(data);\n        arr.push({\n            \"type\": data.type,\n            \"text\": \"\",\n            \"id\": data.id,\n            \"shopId\": data.shopId,\n            \"kid\": data.kid\n        });\n    };\n\n    var pushImg = function(node) {\n        var src = \"\",\n            srcExec = regs.src,\n            domain = srcExec.exec(node)[1];\n\n        if (domain) {\n            src = domain + srcExec.exec(node)[2];\n            arr.push({\n                \"type\": \"image\",\n                \"text\": \"\",\n                \"url\": src\n            });\n        }\n    };\n\n    var pushText = function(text) {\n        var _text = $.trim(text).replace(/&nbsp;/gi, ' ');\n        if (_text != \"\") {\n            arr.push({\n                \"type\": \"text\",\n                \"text\": _text\n            });\n        }\n    };\n    //主体标签事件\n\n    var wrapP = function(tagNode) {\n        // var childNodes = tagNode.childNodes;\n        var tagHtml = tagNode.innerHTML;\n\n        var arrs = tagHtml.split(regs.img);\n\n        for (var i = 0; i < arrs.length; i++) {\n            var _arr = arrs[i].replace(regs.cursor, '');\n            //图片\n            if (_arr.indexOf('<img') !== -1) {\n\n                pushImg(_arr);\n\n                //文本\n            } else if (_arr.indexOf('<br') !== -1) { //带有br\n                var _arrs = _arr.split(regs.br);\n                for (var j = 0; j < _arrs.length; j++) {\n                    var _text = _arrs[j];\n                    if (_text.indexOf('<br') == -1) {\n                        pushText(_text);\n                    }\n                }\n            } else {\n                pushText(_arr);\n            }\n        }\n    };\n\n    //遍历body下的节点 目前只有P 和DIV,img,text(text的为火狐标签溢出bug)\n    for (var i = 0; i < nodes.length; i++) {\n        var tagNode = nodes[i];\n\n        var tagName = tagNode.tagName;\n\n        switch (tagName) {\n            case \"P\":\n                wrapP(tagNode);\n                break;\n            case \"DIV\":\n                pushDiv(tagNode);\n                break;\n            case \"IMG\":\n                pushImg(tagNode.outerHTML);\n                break;\n            case \"#TEXT\":\n                pushText(tagNode.nodeValue);\n                break;\n        }\n\n    }\n};\n\nvar makeFormData = function() {\n    var name = $('[data-node=topicTitle]').val();\n    // var content = $('[data-node=editor]').val();\n    var groupId = $('[data-action=selectGroup]').attr('data-groupid');\n    var components = [];\n\n    // 转换内容数据 使用ue里面的数据，注释 之前textarea使用的数据\n    fillComponents(components);\n    /*\n    var inputList = $('[data-node=picAndShop]').find('textarea[data-action=textBox]');\n    $.each(inputList, function(i, n) {\n        components.push($(n).data('info'));\n    });\n    */\n    return {\n        \"name\": name,\n        \"groupId\": groupId,\n        \"components\": components,\n        \"richText\": ue.getContent()\n    };\n};\n\n//表单检测\nvar formCheck = function() {\n    //标题\n    var title = $('[data-node=topicTitle]').val();\n    //var content = $('[data-node=editor]').val();\n    var content = ue.getContent();\n    //群组ID\n    var groupId = $('[data-action=selectGroup]').attr('data-groupid');\n\n    var checkContent = function(str) {\n        var regtxt = /(<img|<div)/;\n        var reg = /(<p>|<\\/p>|<br>|<br\\/>|&nbsp;| )/gi;\n\n        if (regtxt.test(str) == true) {\n            return false;\n        }\n\n        if (str.replace(reg, \"\") == \"\") {\n            return true;\n        }\n    }\n\n    if ($.trim(title) === '') {\n        alert('请输入话题标题');\n        return false;\n    }\n    if (checkContent(content)) {\n        alert('话题内容不能为空');\n        return false;\n    }\n    if ($.trim(groupId) === '') {\n        alert('圈子不能为空');\n        return false;\n    }\n    return true;\n};\n//提交发布话题\nvar btnPublishTopic = $('[data-action=publishTopic]');\nvar finished = true;\nvar publishTopic = function(option) {\n    var _data = option;\n    btnDisabled(btnPublishTopic);\n    fetch.post(url.get('groupPublishTopic'), {\n        data: _data\n    }).done(function(data) {\n        if (data.success === true) {\n            window.noAlertMessage = 1;\n            setTimeout(function() {\n                window.location.href = $_CONFIG.group_domain + \"topic/detail?tid=\" + data.data.id + '&no_next=1';\n            }, 100)\n        } else {\n            unsuccessful.init(data);\n            btnActivate(btnPublishTopic);\n        }\n    }).fail(function() {\n        btnActivate(btnPublishTopic);\n        alert('发送失败，点击确定重新发布', {\n            ok: function() {\n                publishTopic(_data);\n            }\n        });\n    });\n};\nvar btnDisabled = function(node) {\n    finished = false;\n    node.html('发布中').css('background-color', '#d0d0d0');\n};\nvar btnActivate = function(node) {\n    finished = true;\n    node.html('发布').css('background-color', '#f95353');\n};\nbtnPublishTopic.on('click', function(e) {\n    e.preventDefault();\n    if (formCheck()) {\n        var formData = makeFormData();\n        var type = $('[data-action=selectGroup]').attr('data-grouptype');\n        if (type == 2) {\n            confirm('加入圈子后才能发布话题，确定要加入吗？', {\n                okCls: 'pc-btn',\n                ok: function() {\n                    fetch.post(url.get('joinCircle'), {\n                        validate: true,\n                        data: {\n                            groupid: $('[data-action=selectGroup]').attr('data-groupid'),\n                            imid: 'b_' + $_CONFIG['userId']\n                        }\n                    }).done(function(data /*, textStatus, jqXHR*/ ) {\n                        if (data && data.code === 200 && data.success) {\n                            if (data.data.status === 0) {\n                                confirm('是否确认发布？', {\n                                    okCls: '',\n                                    ok: function() {\n                                        if (finished) {\n                                            publishTopic(formData);\n                                        } else {\n                                            // LEEROY JEEEEEEENKIIIIIIIIIIIIIIINS！\n                                        }\n                                    }\n                                });\n                            }\n                        } else {\n                            alert(data.message)\n                        }\n                    })\n                }\n            });\n        } else {\n            confirm('是否确认发布？', {\n                okCls: '',\n                ok: function() {\n                    if (finished) {\n                        publishTopic(formData);\n                    } else {\n                        // LEEROY JEEEEEEENKIIIIIIIIIIIIIIINS！\n                    }\n                }\n            });\n        }\n    }\n\n});\n\n\n// WEBPACK FOOTER //\n// ./src/js/page/issuePreview/index.js"],"sourceRoot":""}