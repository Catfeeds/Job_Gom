function uuid1(){var o=[];var t="0123456789abcdef";for(var e=0;e<36;e++){o[e]=t.substr(Math.floor(Math.random()*16),1)}o[14]="4";o[19]=t.substr(o[19]&3|8,1);o[8]=o[13]=o[18]=o[23]="-";var i=o.join("");return i}function uuid2(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(o){var t=Math.random()*16|0,e=o=="x"?t:t&3|8;return e.toString(16)})}function uuid3(){function o(){return((1+Math.random())*65536|0).toString(16).substring(1)}return o()+o()+"-"+o()+"-"+o()+"-"+o()+"-"+o()+o()+o()}function uuid4(o,t){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");var i=[],a;t=t||e.length;if(o){for(a=0;a<o;a++)i[a]=e[0|Math.random()*t]}else{var n;i[8]=i[13]=i[18]=i[23]="-";i[14]="4";for(a=0;a<36;a++){if(!i[a]){n=0|Math.random()*16;i[a]=e[a==19?n&3|8:n]}}}return i.join("")}var windowObj={layerShow:function(o,t){var e=$.browser.msie,i=e&&$.browser.version<7;if(!$("#Overlay").length>0){if(!i){$("body").append("<div id='Overlay' style='background:#000;cursor: pointer;display: block;filter:alpha(opacity=60);opacity: 0.6;height:100%;width:100%; position: fixed; left: 0;top: 0;z-index:9999998'></div>")}else{$("html").css({height:"100%"});$("body").css({height:"100%"});$("body").append("<div class='overlay' id='Overlay'><iframe  frameborder=0 id='frame1' style='filter:alpha(opacity=10);opacity: 0.6;height:100%;width:100%;'></iframe></div>")}}$("#Overlay").show();var a=$("#"+t);var n=(document.documentElement.clientHeight-a.height())/2;var c=(document.documentElement.clientWidth-a.width())/2;if(!i){a.css("top",n).css("left",c).css("position","fixed").css("z-index","9999999").show()}else{a.css("position","absolute").show();a.addClass("chagetop")}},layerShow2:function(o,t,e,i){var a=$.browser.msie,n=a&&$.browser.version<7;if(!$("#Overlay").length>0){if(!n){$("body").append("<div id='Overlay' style='background:#000;cursor: pointer;display: block;filter:alpha(opacity=60);opacity: 0.6;height:100%;width:100%; position: fixed; left: 0;top: 0;z-index:9999998'></div>")}else{$("html").css({height:"100%"});$("body").css({height:"100%"});$("body").append("<div class='overlay' id='Overlay'><iframe  frameborder=0 id='frame1' style='filter:alpha(opacity=10);opacity: 0.6;height:100%;width:100%;'></iframe></div>")}}$("#Overlay").show();var c=$("#"+t);if(typeof i=="undefined"){i="0"}if(typeof e=="undefined"){e="0"}var r=(document.documentElement.clientHeight-c.height())/2-parseInt(e);var s=(document.documentElement.clientWidth-c.width())/2-parseInt(i);if(!n){c.css("top",r).css("left",s).css("position","fixed").css("z-index","9999999").show()}else{c.css("position","absolute").show();c.addClass("chagetop")}},closeLayer:function(o){$("#"+o).hide();$("#Overlay").hide()}};function GetQueryString(o){var t=new RegExp("(^|&)"+o+"=([^&]*)(&|$)","i");var e=window.location.search.substr(1).match(t);if(e!=null)return unescape(e[2]);return null}var cpsCode=GetQueryString("param");var activityDescription=document.title;var uuid=uuid1();var promId="";function start(){if(promId==""){$("#popCommonWindow .info").html("").html("对不起，活动已结束");windowObj.layerShow("nobj","popCommonWindow");return false}windowObj.closeLayer("popCaptchaWindow");var o=$("#captchaCode").val();$.ajax({url:"//hd.gome.com.cn/promotion/coupons/getCoupons.do",type:"get",dataType:"jsonp",contentType:"text/html;charset=UTF-8",data:"promId="+promId+"&captchaCode="+o+"&uuid="+uuid+"&cps="+cpsCode+"&activityDescription="+encodeURI(activityDescription),error:function(o,t,e){alert("系统繁忙，请稍后再试。")},success:function(o){if(o.state!="success"){if(o.state=="no_login"){popLogin();return}else if(o.state=="no_promid"){$("#popCommonWindow .info").html("").html("对不起，活动已结束")}else if(o.state=="end"){$("#popCommonWindow .info").html("").html("对不起，活动已结束")}else if(o.state=="user_exception"){$("#popCommonWindow .info").html("").html("用户存在异常")}else if(o.state=="failed"){$("#popCommonWindow .info").html("").html("对不起，优惠券领取失败，请稍后再试")}else if(o.state=="no_start"){$("#popCommonWindow .info").html("").html("活动尚未开始")}else if(o.state=="no_mobile"){$("#popCommonWindow .info").html("").html('您的手机未激活，暂时不能领取优惠券,<a href="javascript:void(0)" onclick="jhsj()">点此激活</a>')}else if(o.state=="user_no_count"){$("#popCommonWindow .info").html("").html("对不起，您已不能再领取此优惠券")}else if(o.state=="Integral_problem"){$("#popCommonWindow .info").html("").html("您的积分不足")}else if(o.state=="coupon_empty"){$("#popCommonWindow .info").html("").html("对不起，您领取的优惠券已发送完，谢谢参与")}else if(o.state=="captcha_empty"){clickCapt();$("#captchaCode").val("");$("#captchaCodeTip").html("请输入验证码");windowObj.layerShow("nobj","popCaptchaWindow");return}else if(o.state=="captcha_error"){clickCapt();$("#captchaCode").val("");$("#captchaCodeTip").html("验证码错误");windowObj.layerShow("nobj","popCaptchaWindow");return}else if(o.state=="captcha_outtime"){clickCapt();$("#captchaCode").val("");$("#captchaCodeTip").html("验证码超时");windowObj.layerShow("nobj","popCaptchaWindow");return}}else if(o.state=="success"){$("#popCommonWindow .info").html("").html("优惠券领取成功，信息如下："+o.data+',请您1分钟后去“<a href="javascript:void(0)" onclick="myaccount()" > 我的国美 </a>”查询。')}else{alert("异常情况:"+o.state);return}windowObj.layerShow("nobj","popCommonWindow")}})}function jhsj(){window.location.href="//g.gome.com.cn/ec/homeus/myaccount/accountSecurity.jsp"}function myaccount(){window.location.href="//g.gome.com.cn/ec/homeus/myaccount/gomeMyCoupon.jsp?"+encodeURIComponent("selpage=优惠券&firstMenu=2")}function popLogin(){g$("header",function(){var o=this;g.login(function(){console.log(o);start()})})}function fetchcoupon(o){promId=o;start()}function captchaLoad(){$("#captchaImage").attr("src","//imgcode.gome.com.cn/getimage.no?type=gome_sale_activities&capCd="+uuid+"&r="+Math.random())}function clickCapt(){var o="//imgcode.gome.com.cn/getimage.no?type=gome_sale_activities&capCd="+uuid+"&r="+Math.random();$("#captchaLoad").html('<img title="点击刷新" gome-src="" src='+o+' id="codeRefreshControlCenter" class="codeRefreshControlCenter" onclick="clickCapt()"></img>')}function showCaptchaTip(o){$("#captcha").val(""),clickCapt(),$("#captchaCode").attr("class","pw-txt pw-short J_txt pw-focus err"),$("#captchaCodeTip").addClass("err-tips"),$("#captchaSucc").removeClass("suc-icon"),$("#captchaCodeTip").html('<i></i><div class="msg-cont">'+o+"</div>")}function captchaBlur(){if($("#captchaCode").val().length==4){$("#captchaCodeTip").html("");$("#captchaSucc").addClass("suc-icon check-icon");return true}else{$("#captchaCode").val("");$("#captchaCodeTip").html("验证码错误");return false}}function handleFocus(o){$("#"+o).removeClass("err"),$("#"+o+"Tip").removeClass("err-tips"),$("#"+o+"Succ").removeClass("suc-icon"),$("#"+o+"Tip").html('<i></i><div class="msg-cont">请输入图片中的4位字符，不区分大小写</div>')}
