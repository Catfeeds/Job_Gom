"use strict";var imgArr=["layer-error.png?1653931","bg.jpg?1653931","center.png?1653931","del.png?1653931","footer.png?1653931","guize-layer.png?1653931","hit.png?1653931","home.png?1653931","layer.png?1653931","layer-bg.png?1653931","left.png?1653931","left-arrow.png?1653931","loading.png?1653931","login.png?1653931","no-hit.png?1653931","once-again.png?1653931","redpacket.png?1653931","right.png?1653931","rule.png?1653931","shabao.png?1653931","share.png?1653931","start.png?1653931","submit.png?1653931","upload.png?1653931","yellow.png?1653931","percent.png?1653931","plan.png?1653931","submit1.png?1653931","cancel.png?1653931","share-layer.png?1653931"],peopleTimer=null,countDownTimer=null,progressBarNum=0,isClick=!0,isStart=!1,timeNum=60,shabaoNum=10,hitNum=0,speed=300,isShare=!0,isUpload=!0,uuid=uuid1(),codeENV=imgcode_domain+"getimage.no?type=gome_sale_activities&capCd=",api=hd_domain+"promotion/hedonicValue/wap/",ENV=source_path+"shabao",setHeaderObj={type:"share",icon:"file://share",shareInfo:{title:"玩游戏练手速  11.11终极大考验",shareDesc:"千万惊喜抢个够  神秘大奖等着你！",shareImageUrl:share_img,shareUrl:location.href,platform:["WeiBo","Wechat","WechatMoments","QQ","QZone","GomeMyFriends","GomeMoments","CopyLink"]}};$.ajaxSettings.beforeSend=function(e){e.withCredentials=!0};var game={dom:{startBtn:$("#startTime"),ruleBtn:$("#ruleBtn"),closeBtn:$(".del"),onceAgainBtn:$(".once-again"),uploadBtn:$("#upload"),feastSubmitBtn:$("#feastSubmit"),homeBtn:$("#home"),shareBtn:$("#shareBtn"),loginBtn:$("#loginBtn"),countDownNum:$("#countDownNum"),shabaoText:$("#shabaoText"),hitNumText:$("#hitNumText"),peoples:$("#peoples"),noHit:$("#noHit"),hit:$("#hit"),getFeastNum:$("#getFeastNum"),overHitNum:$("#overHitNum"),planNum:$("#planNum"),plan:$("#plan"),page:$(".page"),loading:$("#loading"),startConLayer:$("#startCon"),gameOverLayer:$("#gameOver"),ruleLayer:$("#ruleLayer"),confirmFeastLayer:$("#confirmFeast"),uploadErrorLayer:$("#uploadError"),uploadSuccessLayer:$("#uploadSuccess"),shareLayer:$("#shareLayer"),identifyingCodeLayer:$("#identifyingCode"),loginLayer:$("#login"),toastLayer:$("#toastLayer"),shareSuccessLayer:$("#shareSuccess"),errorLayer:$("#error")},init:function(){this.loadImg(),this.bindEvents(),this.getUploadShareStatus(),this.dom.identifyingCodeLayer.find("img").attr("src",codeENV+uuid+"&v="+1*new Date),"app"===access_terminal&&this.resetShare()},bindEvents:function(){var e=this;this.dom.startBtn.click(function(){var a=$(this);"app"===access_terminal?$g.getUserInfo(function(a){e.startGame()},function(t){a.parents(".layer").hide(),e.dom.loginLayer.show()}):e.startGame()}),this.dom.loginBtn.click(function(){$g.login()}),this.dom.closeBtn.click(function(){var a=($(this).parents(".layer"),$(this).parents(".layer").attr("id"));$(this).parents(".layer").hide(),"confirmFeast"===a?e.dom.gameOverLayer.show():"ruleLayer"===a||"gameOver"===a||"shareSuccess"===a||"login"===a?e.dom.startConLayer.show():"uploadSuccess"===a?isUpload?e.dom.gameOverLayer.show():e.dom.startConLayer.show():"toastLayer"!==a&&"error"!==a||e.dom.uploadSuccessLayer.show()}),this.dom.ruleBtn.click(function(){e.dom.ruleLayer.show().siblings("#startCon").hide()}),this.dom.onceAgainBtn.click(function(){$(this).parents(".layer").hide(),e.startGame()}),this.dom.uploadBtn.click(function(){$(this).parents(".layer").hide(),isShare||e.dom.uploadSuccessLayer.find(".share-text").css("opacity","0"),isUpload?e.dom.confirmFeastLayer.show():(e.dom.uploadSuccessLayer.find(".upload-success-text").text("今日已上传过享乐值！"),e.dom.uploadSuccessLayer.show())}),this.dom.feastSubmitBtn.click(function(){$(this).parents(".layer").hide(),e.dom.identifyingCodeLayer.find("input").val(""),e.dom.identifyingCodeLayer.show()}),e.dom.identifyingCodeLayer.on("click",".cancel",function(){e.dom.confirmFeastLayer.show(),$(this).parents(".layer").hide()}),e.dom.identifyingCodeLayer.on("click",".confirm",function(){var a=e.dom.identifyingCodeLayer.find("input").val(),t=$(this);if(""!==a&&4===a.length){var o={promId:shabaoid,throwSandbagsCount:hitNum,captchaCode:a,uuid:uuid,source:access_terminal,equipmentUfpd:$g.cookie.parse().ufpd,mac:n,ufpd:$g.cookie.parse().ufpd,version:i||"",uniqueId:n,is_req:i>64?"1":"0",uA:Base64.encode(navigator.userAgent.toLowerCase()),luckType:"normal"},i=-1;$g.system.android&&navigator.userAgent.match(/gome/)?i=navigator.userAgent.match(/gome[plus]{0,4}\/[iphone\/]{0,7}(\d*)/)[1]:$g.system.ios&&navigator.userAgent.match(/gome/)&&(i=navigator.userAgent.match(/gome[plus]{0,4}\/[iphone\/]{0,7}(\d*)/)[1]);var n=$g.cookie.parse().__clickidc;$g.env.gomeplus||i>64&&$g.env.gome?o.is_req="1":o.is_req="0",$g.env.app&&(o.source="app",o.app_type=$g.system.android?"android_app":"ios_app",o.mac=o.app_type+i+n,o.platform=$g.system.android?"2":"1",o.equipmentUfpd=$g.cookie.parse().GDF,o.ufpd=$g.cookie.parse().GDF),$.ajax({type:"GET",xhrFields:{withCredentials:!0},crossDomain:!0,url:api+"doThrowSandbagsResult.do",data:o,dataType:"json",success:function(a){"success"==a.state?(t.parents(".layer").hide(),e.dom.uploadSuccessLayer.show(),isUpload=!1):(t.parents(".layer").hide(),e.dom.uploadErrorLayer.show(),e.dom.identifyingCodeLayer.find("img").attr("src",codeENV+uuid+"&v="+1*new Date),setTimeout(function(){e.dom.uploadErrorLayer.hide(),e.dom.gameOverLayer.show()},3e3))},error:function(a){e.dom.identifyingCodeLayer.find("img").attr("src",codeENV+uuid+"&v="+1*new Date)}})}else e.dom.identifyingCodeLayer.find("input").val(""),e.dom.identifyingCodeLayer.find("p").addClass("shake"),e.dom.identifyingCodeLayer.find("img").attr("src",codeENV+uuid+"&v="+1*new Date),setTimeout(function(){e.dom.identifyingCodeLayer.find("p").removeClass("shake")},500)}),e.dom.identifyingCodeLayer.find("img").click(function(){$(this).attr("src",codeENV+uuid+"&v="+1*new Date)}),e.dom.identifyingCodeLayer.find("input").focus(function(){document.body.scrollTop=200}),this.dom.shareLayer.click(function(){$(this).hide(),e.dom.startConLayer.show()}),this.dom.homeBtn.click(function(){$(this).parents(".layer").hide(),e.dom.startConLayer.show()}),this.dom.errorLayer.find(".submit").click(function(){$(this).parents(".layer").hide(),e.dom.uploadSuccessLayer.show()}),this.dom.shareBtn.click(function(){var a=$(this),t=!!window.navigator.userAgent.match(/android/i);if("app"===access_terminal){var o={title:"玩游戏练手速  11.11终极大考验",shareDesc:"千万惊喜抢个够  神秘大奖等着你！",shareImageUrl:share_img,shareUrl:location.href,platform:["WeiBo","Wechat","WechatMoments","QQ","QZone","GomeMyFriends","GomeMoments","CopyLink"]};if(t&&window.navigator.userAgent.match(/gome/)){window.navigator.userAgent.match(/gome[plus]{0,4}\/[iphone\/]{0,7}(\d*)/)[1]<100?(e.shareover(),a.parents(".layer").hide(),e.dom.shareLayer.show()):e.appShare(o)}else e.appShare(o)}else"weixin"===access_terminal?(a.parents(".layer").hide(),e.dom.shareLayer.show()):(a.parents(".layer").hide(),e.dom.toastLayer.find("p").text("请用浏览器自带分享功能分享"),e.dom.toastLayer.show())}),this.dom.toastLayer.find(".confirm").click(function(){$(this).parents(".layer").hide(),e.dom.uploadSuccessLayer.show()}),this.dom.errorLayer.find(".confirm").click(function(){$(this).parents(".layer").hide(),e.dom.uploadSuccessLayer.show()}),this.dom.page.click(function(a){var t=$(a.target);if(isClick&&isStart){isClick=!1;var o=t.attr("class");if(clearInterval(peopleTimer),"peoples"===t.attr("id")||"people"===o||"people-img"===o){var i=t.css("display");"people"===o&&(i=t.children("p").css("display")),"none"===i?(e.dom.noHit.show(),e.dom.peoples.find("p").hide(),setTimeout(function(){e.dom.noHit.hide(),e.gameOver()},500)):(e.dom.hit.show(),e.dom.peoples.find("p").hide(),e.dom.hitNumText.text(hitNum+=1),setTimeout(function(){e.dom.hit.hide(),e.gameOver()},500))}else e.dom.noHit.show(),e.dom.peoples.find("p").hide(),setTimeout(function(){e.dom.noHit.hide(),e.gameOver()},500);shabaoNum--,e.dom.shabaoText.text(shabaoNum)}})},appShare:function(e){var a=this;$g.callShareComp(e,function(e){"0"===e.shareResult?(a.dom.shareSuccessLayer.css("display","block"),a.dom.shareBtn.parents(".layer").hide(),a.shareover()):"1"===e.shareResult&&(a.dom.shareBtn.parents(".layer").hide(),$("#error").css("display","block"))},function(e){a.dom.shareBtn.parents(".layer").hide(),$("#error").css("display","block")})},resetShare:function(){$g.ready().then(function(){$g.env.app&&$g.setHeadBar({menus:{isShowCloseMenu:"Y",rightMenus:[setHeaderObj]}})})},startGame:function(){timeNum=60,shabaoNum=10,hitNum=0,speed=500,this.dom.shabaoText.text(shabaoNum),this.dom.hitNumText.text(hitNum),this.dom.countDownNum.text(timeNum),this.dom.startConLayer.hide(),this.countDown(),this.peopleRun(speed),setTimeout(function(){isStart=!0},350)},loadImg:function(){var e=imgArr.length,a=this,t=0;imgArr.forEach(function(o,i){var n=new Image;n.onload=function(){progressBarNum+=1,t=parseInt(progressBarNum/e*100),a.dom.plan.css("width",t+"%"),a.dom.planNum.text(t),100===t&&(a.dom.startConLayer.show(),a.dom.loading.hide())},n.src=ENV+"/images/"+o})},gameOver:function(){shabaoNum<=0||timeNum<=0?(clearInterval(countDownTimer),clearInterval(peopleTimer),this.dom.gameOverLayer.show(),this.dom.peoples.find("p").show(),this.gameOverText(),isStart=!1):this.peopleRun(speed)},gameOverText:function(){this.dom.overHitNum.text(hitNum),this.dom.getFeastNum.text(20*hitNum)},countDown:function(){var e=this;countDownTimer=setInterval(function(){timeNum--,timeNum%4==0&&(clearInterval(peopleTimer),e.peopleRun(speed-=10)),timeNum<0?(clearInterval(countDownTimer),e.gameOver()):e.dom.countDownNum.text(timeNum)},1e3)},peopleRun:function(e){var a=this;isClick=!0,clearInterval(peopleTimer),peopleTimer=setInterval(function(){var e=Math.floor(3*Math.random());a.dom.peoples.children("li").eq(e).children("p").show().parent().siblings().children("p").hide()},e)},getUploadShareStatus:function(){$.ajax({type:"GET",xhrFields:{withCredentials:!0},crossDomain:!0,url:api+"getUploadHedonicState.do",data:{promId:shabaoid,source:access_terminal},dataType:"json",success:function(e){console.log(e),"success"==e.state&&(isUpload="1"===e.data.uploadState,isShare="1"===e.data.shareState)},error:function(e){console.log(e)}})},shareover:function(){isShare&&$.ajax({type:"GET",xhrFields:{withCredentials:!0},crossDomain:!0,url:api+"doShareHedonicValue.do",data:{promId:shabaoid,source:access_terminal},dataType:"json",success:function(e){console.log(e),"success"==e.state&&(isShare=!1)},error:function(e){console.log(e)}})}};game.init();