"use strict";function getRootDomainName(e){if("1"==plat_form){var t="";return t=window.location.hostname.indexOf("gomeplus.com")>0?http+"//hd.gomeplus.com/promotion/hedonicValue/wap/":http+"//hd.gome.com.cn/promotion/hedonicValue/wap/",e[1]=t,e}}function getCookie(e){var t,o=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(o))?unescape(t[2]):null}function Risk(){var e=-1;$g.system.android&&navigator.userAgent.match(/gome/)?e=navigator.userAgent.match(/gome[plus]{0,4}\/[iphone\/]{0,7}(\d*)/)[1]:$g.system.ios&&navigator.userAgent.match(/gome/)&&(e=navigator.userAgent.match(/gome[plus]{0,4}\/[iphone\/]{0,7}(\d*)/)[1]);var t=$g.cookie.parse().__clickidc,o={equipmentUfpd:$g.cookie.parse().ufpd,mac:t,ufpd:$g.cookie.parse().ufpd,version:e||"",uniqueId:t,is_req:e>64?"1":"0",uA:Base64.encode(navigator.userAgent.toLowerCase()),luckType:"normal"};return $g.env.gomeplus||e>64&&$g.env.gome?o.is_req="1":o.is_req="0",$g.env.app&&(o.source="app",o.app_type=$g.system.android?"android_app":"ios_app",o.mac=o.app_type+e+t,o.platform=$g.system.android?"2":"1",o.equipmentUfpd=$g.cookie.parse().GDF,o.ufpd=$g.cookie.parse().GDF),o}var api="http://hd-u1.atguat.com.cn/promotion/hedonicValue/wap/",apiENV=["http://hd-u1.atguat.com.cn/promotion/hedonicValue/wap/","http://hd.gome.com.cn/promotion/hedonicValue/wap/"],capCdApi="http://imgcode.atguat.com.cn/",proCapCdApi="http://imgcode.gome.com.cn/",capCdENV=["http://imgcode.atguat.com.cn/","http://imgcode.gome.com.cn/"],imgApi="http://js.dev.meixincdn.com:1314/CDN8176/dist/external/game/dishu/images/",ENV=["http://js.dev.meixincdn.com:1314/CDN8177/dist/external/game/dishu","http://js.dev.meixincdn.com:1314/CDN8177/dist/external/game/dishu"],http="http:",td=new Array,playing=!1,shareing=!1,score=0,beat=20,success=0,knock=0,countDown=60,percent=0,totle=0,num=0,interId=null,timeId=null,imgArray=["security.png?1653931","ensure.png?1653931","cancel.png?1653931","bg.jpg?1653931","close.png?1653931","opa5.png?1653931","hintBg.png?1653931","failureBg.png?1653931","lotto.png?1653931","playAgain.png?1653931","loading.png?1653931","plan.png?1653931","percent.png?1653931","loadPic.png?1653931","homeTitle.png?1653931","startGame.png?1653931","ruleGame.png?1653931","back.png?1653931","rule-bg.png?1653931","backHome.png?1653931","hintBtn.png?1653931","gameGrade.png?1653931","upload.png?1653931","again.png?1653931","failed.png?1653931","share.png?1653931","game.jpg?1653931","state.png?1653931","holeTop.png?1653931","holeBottom.png?1653931","nullHit.png?1653931","hit.png?1653931","star.png?1653931","hammer.png?1653931"],curArray=[],current=0,$ratEles=$(".ratting-box"),$hummerEles=$("#hammer"),$surplusEles=$("#surplus"),$addOneEles=$("#addOne"),$gameoverEles=$("#gameover"),$overnumEles=$("#overnum"),$overscoreEles=$("#overscore"),$gameagainEles=$("#gameagain"),gameGoOn=!1,curityText=null,shareState=0,uploadState=0,uploadStated=!1,isAndroid=!!window.navigator.userAgent.match(/android/i),uuid=uuid1(),url=imgcode_domain+"getimage.no?type=gome_sale_activities&capCd="+uuid+"&v="+1*new Date;$("#curityimg").attr("src",""),$("#curityimg").attr("src",url),$.ajaxSettings.beforeSend=function(e){e.withCredentials=!0};var game={GameOver:function(){console.log(interId),clearInterval(interId),game.timeStop(),beat=0,playing=!1,gameGoOn=!1,shareing=!0,$hummerEles.hide(),$(".ratting").addClass("hide"),$surplusEles.html(beat),$overnumEles.html(knock),$overscoreEles.html(score),$gameoverEles.show()},getScrollTop:function(){var e=0;return document.documentElement&&document.documentElement.scrollTop?e=document.documentElement.scrollTop:document.body&&(e=document.body.scrollTop),e},eventBind:function(){document.querySelector("#plan").style.width="0%","app"===access_terminal&&game.resetShare();for(var e=0;e<6;e++)$("#rat_"+e).attr("i",e).on("touchstart",function(){game.hit($(this).attr("i"))});$hummerEles[0].addEventListener("webkitAnimationEnd",function(){$hummerEles.removeClass("rotateInDownRight"),$hummerEles.hide()},!1),$hummerEles[0].addEventListener("animationend",function(){$hummerEles.removeClass("rotateInDownRight"),$hummerEles.hide()},!1),$(document).on("touchstart",function(e){beat-=1,$surplusEles.html(beat),beat<=0?(beat=0,$surplusEles.html(beat),shareing||game.GameOver()):($("#hammer").css({top:e.touches[0].clientY+game.getScrollTop()-parseFloat($("#hammer").css("height"))/2+"px",left:e.touches[0].clientX-parseFloat($("#hammer").css("width"))/2+"px"}),$hummerEles.show(),$hummerEles.addClass("rotateInDownRight"))},!1),$("#security .security-title")[0].addEventListener("webkitAnimationEnd",function(){$("#security .security-title").removeClass("shake")}),$ratEles.forEach(function(e,t){$(e).attr("onoff",!1),e.addEventListener("webkitAnimationStart",function(){$(e).attr("onoff",!0),$(e).children().removeClass("hide"),$(e).parents(".hole").addClass("nullHit").removeClass("hit")},!1),e.addEventListener("webkitAnimationEnd",function(){$(e).attr("onoff",!1),$(e).removeClass("move"),$(e).children(".ratting").addClass("hide")},!1),e.addEventListener("animationstart",function(){$(e).attr("onoff",!0),$(e).children().removeClass("hide"),$(e).parents(".hole").addClass("nullHit").removeClass("hit")},!1),e.addEventListener("animationend",function(){$(e).attr("onoff",!1),$(e).removeClass("move"),$(e).children(".ratting").addClass("hide")},!1)}),$("#curityimg").on("click",function(){url=imgcode_domain+"getimage.no?type=gome_sale_activities&capCd="+uuid+"&v="+1*new Date,$("#curityimg").attr("src",""),$("#curityimg").attr("src",url)}),$("#ensure").on("click",function(){game.upload(uuid)}),$("#gameover .close").on("click",function(){$("#gameover").hide(),$("#game").hide(),$("#home").show()}),$("#certain .close").on("click",function(){$("#home").hide(),$("#certain").hide(),$("#game").hide(),$("#gameover").show()}),$("#security .cancel").on("click",function(){$("#gameover").hide(),$("#security").hide(),$("#game").hide(),$("#certain").show()}),$("#succeed .close").on("click",function(){$("#certain").hide(),$("#succeed").hide(),$("#game").hide(),$("#home").show()}),$("#toLoad .toLoad-btn").on("click",function(){$g.login()}),$("#toLoad .close").on("click",function(){$("#toLoad").hide(),$("#home").show()}),$("#hint .close").on("click",function(){$("#hint").hide(),$("#game").hide(),$("#succeed").show()}),$("#hint #hint-btn").on("click",function(){$("#hint").hide(),$("#game").hide(),$("#succeed").show()}),$("#share .close").on("click",function(){$("#share").hide(),$("#game").hide(),$("#home").show()}),$("#happy .close").on("click",function(){$("#share").hide(),$("#happy").hide(),$("#game").hide(),$("#home").show()})},loading:function(){game.HedonicValue(),totle=imgArray.length,imgArray.forEach(function(e,t){var o=document.createElement("img");o.src=source_path+"dishu/images/"+e,o.onload=function(){num+=1,percent=num/totle*100,percent=percent.toFixed(0),document.querySelector("#plan").style.width=percent+"%",document.querySelector("#planNum").innerHTML=percent,percent/100==1&&(document.querySelector("#loading").style.display="none",document.querySelector("#home").style.display="block")}})},ruleShow:function(){document.querySelector("#rule").style.display="block"},ruleClose:function(){document.querySelector("#rule").style.display="none"},GameStart:function(e){e=window.event||arguments.callee.caller.arguments[0],e.stopPropagation(),$hummerEles.hide(),"app"==access_terminal?$g.getUserInfo(function(e){game.GameStartOver(),console.log("登录成功")},function(e){$("#home").hide(),$("#toLoad").show(),console.log("登录失败")}):game.GameStartOver()},GameStartOver:function(){$("#toLoad").hide(),$("#happy").hide(),$("#share").hide(),success=0,score=0,knock=0,beat=20,playing=!0,shareing=!1,gameGoOn=!0,countDown=60,document.querySelector("#secondTime").innerHTML="01",document.querySelector("#milliseTime").innerHTML="00",countDown-=1,document.querySelector("#home").style.display="none",document.querySelector("#game").style.display="block",$(".ratting").addClass("hide"),$("#succeed").hide(),$gameoverEles.hide(),$("#curitytext").val(""),$surplusEles.html(beat),$("#knock").html(0),$(".ratting-box").removeClass("move"),clearInterval(interId),interId=setInterval(game.timeShow,1e3),console.log(interId)},timeShow:function(){document.querySelector("#time").value=countDown,gameGoOn&&(0==countDown?(document.querySelector("#milliseTime").innerHTML="00",game.GameOver()):60==countDown?(document.querySelector("#secondTime").innerHTML="01",document.querySelector("#milliseTime").innerHTML="00",countDown-=1,game.show()):59==countDown?(document.querySelector("#secondTime").innerHTML="00",document.querySelector("#milliseTime").innerHTML=countDown,countDown-=1,game.show()):countDown<20&&countDown>=10?(document.querySelector("#milliseTime").innerHTML=countDown,countDown-=1,game.show()):countDown<10?(document.querySelector("#milliseTime").innerHTML="0"+countDown,countDown-=1,game.show()):(document.querySelector("#milliseTime").innerHTML=countDown,countDown-=1,game.show()))},timeStop:function(){clearInterval(interId),countDown=0},show:function(){var e=Math.floor(3*Math.random());curArray=[];for(var t=0;t<=e;t++)game.count();curArray.forEach(function(e,t){var o=$("#rat_"+e);playing&&o.parent().attr("onoff")&&!o[0].hit&&o.parent().addClass("move")})},count:function(){return current=Math.floor(6*Math.random()),-1==curArray.indexOf(current)&&curArray?curArray.push(current):game.count(),curArray},hit:function(e){if(0!=playing){$("#rat_"+e).parents(".hole").addClass("hit").removeClass("nullHit");var t=document.getElementById("rat_"+e);t.hit||(score+=10,knock+=1,success=knock/beat,$("#rat_"+e).removeClass("hide").parent().removeClass("move").addClass("moveHit"),t.hit=!0,$("#rat_"+e).eq(0).hit=!0,$addOneEles.show(),gameGoOn=!1,setTimeout(function(){t.hit=!1,$("#rat_"+e).eq(0).hit=!1,$("#rat_"+e).addClass("hide").parent().attr("onoff",!1),$addOneEles.hide(),gameGoOn=!0},500),$("#knock").html(knock))}},HedonicValue:function(){$.ajax({type:"GET",xhrFields:{withCredentials:!0},crossDomain:!0,url:hd_domain+"promotion/hedonicValue/wap/getUploadHedonicState.do",data:{promId:dishuid,source:access_terminal},dataType:"json",success:function(e){console.log(e),"success"==e.state&&(uploadState=e.data.uploadState,shareState=e.data.shareState)},error:function(e){console.log(e)}})},certain:function(){$gameoverEles.hide(),$("#gameover").hide(),1==uploadState?($("#certain").show(),uploadStated=!0):2==uploadState&&($("#succeed").show().find(".upload-succeed").html("今日已上传过享乐值！"),1==shareState?$("#succeed .extra").html("分享可额外获得<span>100享乐值</span>哦~~~"):2==shareState&&$("#succeed .extra").html(""))},curity:function(){$("#gameover").hide(),$("#certain").hide(),$("#security").show(),$("#curityimg").attr("src",url)},upload:function(e){if(curityText=$("#curitytext").val(),4==curityText.length){var t=$.extend({},Risk(),{promId:dishuid,hitGopherCount:knock,captchaCode:curityText,uuid:e,source:access_terminal});$.ajax({type:"GET",xhrFields:{withCredentials:!0},crossDomain:!0,url:hd_domain+"promotion/hedonicValue/wap/doHitGopherResult.do",data:t,dataType:"json",success:function(e){console.log(e),"success"==e.state?(uploadState=2,$("#security").hide(),$("#succeed").show()):($("#security").hide(),$("#failure").show(),setTimeout(function(){$("#failure").hide(),$("#gameover").show()},3e3),url=imgcode_domain+"getimage.no?type=gome_sale_activities&capCd="+uuid+"&v="+1*new Date,$("#curityimg").attr("src",url))},error:function(e){console.log(e)}})}else $("#security .security-title").addClass("shake")},shareover:function(){if(1==shareState){var e=$.extend({},Risk(),{promId:dishuid,source:access_terminal});$.ajax({type:"GET",xhrFields:{withCredentials:!0},crossDomain:!0,url:hd_domain+"promotion/hedonicValue/wap/doShareHedonicValue.do",data:e,dataType:"json",success:function(e){console.log(e),"success"==e.state&&(shareState=2,$("#wShare").hide(),$("#game").hide(),$("#rule").hide(),$("#happy .smallHint-cont").html("分享成功"),$("#happy").show())},error:function(e){$("#wShare").hide(),$("#game").hide(),$("#rule").hide(),$("#happy").hide(),$("#home").show()}})}else $("#wShare").hide(),$("#game").hide(),$("#rule").hide(),$("#happy").hide(),$("#home").show()},resetShare:function(){$g.ready().then(function(){var e={type:"share",icon:"file://share",shareInfo:{title:"玩游戏练手速  11.11终极大考验",shareDesc:"千万惊喜抢个够  神秘大奖等着你！",shareImageUrl:share_img,shareUrl:location.href,platform:["WeiBo","Wechat","WechatMoments","QQ","QZone","GomeMyFriends","GomeMoments","CopyLink"]}};$g.env.app&&$g.setHeadBar({menus:{isShowCloseMenu:"Y",rightMenus:[e]}})})},appShare:function(e){$g.callShareComp(e,function(e){"0"===e.shareResult?($("#game").hide(),$("#wShare").hide(),$("#succeed").hide(),$("#happy .smallHint-cont").html("分享成功"),$("#happy").show(),game.shareover()):"1"===e.shareResult&&($("#game").hide(),$("#wShare").hide(),$("#succeed").hide(),$("#happy .smallHint-cont").html("分享失败"),$("#happy").show())},function(e){$("#game").hide(),$("#wShare").hide(),$("#succeed").hide(),$("#happy .smallHint-cont").html("分享失败"),$("#happy").show()})},share:function(){if(access_terminal)if("weixin"==access_terminal)$("#succeed").hide(),$("#game").hide(),$("#wShare").show();else if("app"==access_terminal){var e={title:"玩游戏练手速  11.11终极大考验",shareDesc:"千万惊喜抢个够  神秘大奖等着你！",shareImageUrl:share_img,shareUrl:location.href,platform:["WeiBo","Wechat","WechatMoments","QQ","QZone","GomeMyFriends","GomeMoments","CopyLink"]};if(isAndroid&&window.navigator.userAgent.match(/gome/)){var t=window.navigator.userAgent.match(/gome[plus]{0,4}\/[iphone\/]{0,7}(\d*)/)[1];t<100?game.shareover():game.appShare(e)}else game.appShare(e)}else"wap"==access_terminal&&($("#succeed").hide(),$("#game").hide(),$("#hint .smallHint-cont").html("请用浏览器自带分享功能分享"),$("#hint").show())}};game.eventBind(),game.loading();