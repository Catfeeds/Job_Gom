webpackJsonp([63],{"287":function(t,exports,e){"use strict";(function($,t){var e=function(t){for(var e=ue.document.body.children,n=function(e){var n="",a=regs.src,o=a.exec(e)[1];o&&(n=o+a.exec(e)[2],t.push({"type":"image","text":"","url":n}))},a=function(e){var n=$.trim(e).replace(/&nbsp;/gi," ");""!=n&&t.push({"type":"text","text":n})},o=0;o<e.length;o++){var i=e[o];switch(i.tagName){case"P":!function(t){for(var e=t.innerHTML,o=e.split(regs.img),i=0;i<o.length;i++){var r=o[i].replace(regs.cursor,"");if(-1!==r.indexOf("<img"))n(r);else if(-1!==r.indexOf("<br"))for(var c=r.split(regs.br),u=0;u<c.length;u++){var s=c[u];-1==s.indexOf("<br")&&a(s)}else a(r)}}(i);break;case"DIV":!function(e){for(var n=e.childNodes,a="",o=0;o<n.length;o++){var i=n[o].attributes;if(i){a=i["data-info"].nodeValue;break}}a=JSON.parse(a),t.push({"type":a.type,"text":"","id":a.id,"shopId":a.shopId,"kid":a.kid})}(i);break;case"IMG":n(i.outerHTML);break;case"#TEXT":a(i.nodeValue)}}},n=function(){var t=$("[data-node=topicTitle]").val(),n=$("[data-action=selectGroup]").attr("data-groupid"),a=[];return e(a),{"name":t,"groupId":n,"components":a,"richText":ue.getContent()}},a=function(){var t=$("[data-node=topicTitle]").val(),e=ue.getContent(),n=$("[data-action=selectGroup]").attr("data-groupid");return""===$.trim(t)?(alert("请输入话题标题"),!1):function(t){var e=/(<img|<div)/,n=/(<p>|<\/p>|<br>|<br\/>|&nbsp;| )/gi;return 1!=e.test(t)&&(""==t.replace(n,"")||void 0)}(e)?(alert("话题内容不能为空"),!1):""!==$.trim(n)||(alert("圈子不能为空"),!1)},o=$("[data-action=publishTopic]"),i=!0,r=function e(n){var a=n;c(o),fetch.post(url.get("groupPublishTopic"),{"data":a}).done(function(e){!0===e.success?(window.noAlertMessage=1,setTimeout(function(){window.location.href=t.group_domain+"topic/detail?tid="+e.data.id+"&no_next=1"},100)):(unsuccessful.init(e),u(o))}).fail(function(){u(o),alert("发送失败，点击确定重新发布",{"ok":function(){e(a)}})})},c=function(t){i=!1,t.html("发布中").css("background-color","#d0d0d0")},u=function(t){i=!0,t.html("发布").css("background-color","#f95353")};o.on("click",function(e){if(e.preventDefault(),a()){var o=n();2==$("[data-action=selectGroup]").attr("data-grouptype")?confirm("加入圈子后才能发布话题，确定要加入吗？",{"okCls":"pc-btn","ok":function(){fetch.post(url.get("joinCircle"),{"validate":!0,"data":{"groupid":$("[data-action=selectGroup]").attr("data-groupid"),"imid":"b_"+t.userId}}).done(function(t){t&&200===t.code&&t.success?0===t.data.status&&confirm("是否确认发布？",{"okCls":"ok-btn","cancelCls":"cancel-btn","ok":function(){i&&r(o)}}):alert(t.message)})}}):confirm("是否确认发布？",{"okCls":"ok-btn","cancelCls":"cancel-btn","ok":function(){i&&r(o)}})}})}).call(exports,e(0),e(1))}},[287]);