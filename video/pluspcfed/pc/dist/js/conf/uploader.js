webpackJsonp([22],{"177":function(t,exports,e){"use strict";var n=function(t){t.height((document.body.scrollWidth/3||document.body.clientWidth/3)-2)},i=function(t,e){t.width((document.body.scrollWidth/3||document.body.clientWidth/3)-2),t.height(t.width()),e.width((document.body.scrollWidth/3||document.body.clientWidth/3)-2),e.height(e.width())};t.exports={"init":n,"addList":i}},"178":function(t,exports,e){"use strict";(function($){var n=e(2),i=e(5),a=e(177),o=e(486),r=e(487),s=e(179),u=e(488),c={"list":[],"addNewList":[],"totalUpNumber":0,"toastOnoff":!1,"alertOnoff":!1,"elements":{"$upIcon":$("#up_icon"),"$mainTopic":$(".main-topic"),"$mainList":$(".main-list"),"$mainTouchBtn":$(".main-touch-btn"),"$mainPrompt":$(".main-prompt"),"$mainPhotoNumber":$(".main-photo-number"),"$boxMain":$(".box-main"),"$wrapDown":$(".wrap-down")},"initNum":function(){this.elements.$mainPhotoNumber.html(upNumber-this.list.length),this.touchBtn()},"touchBtn":function(){var t=this;this.elements.$upIcon.on("touchstart",function(){switch(t.list.length){case 0:t.elements.$upIcon.change(function(){0!=upNumber?(window.StatusOnoff=!0,t.addNewList.length=0,t.elements.$wrapDown.hide(),t.elements.$mainList.append(o()),t.touchBtnMore(),t.captureComplete(this)):(t.elements.$upIcon.val(""),t.toastMask(["您选择的图片数量超过"+upNumber+"张","超出部分将不会上传"]))});break;default:t.toastMask(["您选择的图片数量超过"+upNumber+"张","超出部分将不会上传"])}t.elements.$upIcon.off("touchstart")})},"touchBtnMore":function(){var t=this;this.elements.$mainBtn=$("#up_icon_more"),this.elements.$mainBtn.on("touchstart",function(){t.elements.$mainBtn.change(function(){0!=upNumber?(window.StatusOnoff=!0,t.addNewList.length=0,t.captureComplete(this)):(t.elements.$mainBtn.val(""),t.toastMask(["您选择的图片数量超过"+upNumber+"张","超出部分将不会上传"]))}),t.elements.$mainBtn.off("touchstart")})},"toastMask":function(t){var e=this;this.elements.$upIcon=$("#up_icon"),this.elements.$upIcon.attr("disabled",!0),this.elements.$mainToast=$(".main-toast"),this.elements.$mainToast.html(s({"data":t})),this.elements.$mainToast.css({"transition":"opacity 1s linear 3s","opacity":"0"}),setTimeout(function(){e.elements.$mainToast.removeAttr("style"),e.elements.$mainToast.html(""),e.elements.$upIcon.attr("disabled",!1)},4e3)},"addToList":function(t,e,n){var i=this;if(0!=upNumber){this.showList(!0),i.elements.$mainWrap=$("#up_icon_wrap"),this.elements.$mainWrap.before(r({"data":t})),e>=upNumber&&i.elements.$mainWrap.hide(),this.elements.$mainPhotoNumber.html(upNumber-this.list.length);var o=$(".touch-input-icon")||null,s=$(".touch-btn-icon")||null;a.addList(o,s)}else i.toastMask(["您选择的图片数量超过"+upNumber+"张","超出部分将不会上传"])},"showList":function(t){t&&(this.elements.$mainTopic.css({"display":"block"}),this.elements.$mainTouchBtn.css({"display":"none"}),this.elements.$mainList.css({"display":"flex"}))},"showFail":function(){},"simulateAlert":function(t){var e=this;this.alertOnoff?e.elements.$alert.show():($("body").append(u({"data":t})),e.elements.$alert=$(".alert-box"),e.elements.$alert.on("touchstart",function(){$(this).hide()}),this.alertOnoff=!this.alertOnoff)},"captureComplete":function(t){var e=this,n=Array.prototype.slice.call(t.files,0);n=this.unique(this.unique(this.unique(n))),console.log(this.list.length+n.length),console.log(window.upNumber),this.totalUpNumber=this.list.length+n.length>upNumber?upNumber:this.list.length+n.length,n.every(function(t,i,a){/^image/i.test(t.type)||(e.elements.$upIcon.val(""),n.pop(),a.pop(),e.toastMask(["请选择图片文件"]));var o=new FileReader;return o.readAsDataURL(t),o.onabort=function(t){e.showFail()},o.onerror=function(t){e.showFail()},o.onload=function(i){"image/gif"==t.type?this.result.length<1048576?e.compressImage(this.result,t.type):(e.elements.$upIcon.val(""),n.pop(),a.pop(),e.toastMask(["上传图片请小于1MB"])):e.compressImage(this.result,t.type)},!0})},"createObjectURL":function(t){return window[window.webkitURL?"webkitURL":"URL"].createObjectURL(t)},"compressImage":function(t,e){var n=this,i=new Image,a=document.createElement("canvas"),o=a.getContext("2d");i.src=t,i.onload=function(){if("image/gif"!=e&&/^image/i.test(e)){var r=i.width,s=i.height;r/s>=1?(a.height=s>800?800:s,a.width=a.height,o.drawImage(i,(r-s)/2,0,s,s,0,0,a.height,a.height)):(a.width=r>800?800:r,a.height=a.width,o.drawImage(i,0,(s-r)/2,r,r,0,0,a.width,a.width));var u=a.toDataURL("image/jpeg");n.pushImageData(u)}else{if("image/gif"!=e||!/^image/i.test(e))return!1;var u=t;n.pushImageData(u)}}},"pushImageData":function(t){var e=this;if(e.list.push(t),e.addNewList.push(t),e.list.length<=upNumber){if(e.addToList(t,e.list.length,e.totalUpNumber),e.list.length===e.totalUpNumber){var n=parseInt(document.body.style.height),i=parseInt($(document).height());e.elements.$boxMain[0].style.height=i>n?"auto":"80vh",e.elements.$wrapDown.show(),e.uploadQueueFetchEmitter(e.addNewList,function(){window.StatusOnoff=!window.StatusOnoff})}}else e.list.length=upNumber,e.totalUpNumber>=upNumber&&e.list.length==upNumber&&!e.toastOnoff&&e.toastMask(["您选择的图片数量超过"+upNumber+"张","超出部分将不会上传"])},"uploadFetch":function(t){var e=this;n.post(i.get("h5TopicUpload"),{"data":{"cachekey":pageId,"groupkey":qrcodeId,"num":e.totalUpNumber,"content":t}}).done(function(t){!0===t.success&&(e.elements.$cubeMask=$(".cube-mask"),e.elements.$cubeMask.hide())}).fail(function(t){console.error(t)})},"uploadQueueFetch":function(t){var e=this,a={"url":i.get("h5TopicUpload"),"cachekey":e.getQueryString("pageId"),"groupkey":e.getQueryString("qrcodeId"),"qrcodeFrom":qrcodeFrom||""};return new Promise(function(i,o){n.post(a.url,{"data":{"cachekey":a.cachekey,"groupkey":a.groupkey,"num":e.totalUpNumber,"content":t}}).done(function(t){1==t.success?(e.elements.$cubeMask=$(".cube-mask"),e.elements.$cubeMask.hide(),setTimeout(function(){i(t)},250)):console.log(t)}).fail(function(t){console.error(t)})})},"uploadQueueFetchEmitter":function(t,e){var n=this;t.reduce(function(t,e){return t.then(function(){n.uploadQueueFetch(e)})},Promise.resolve("init"));e&&e()},"onprogress":function(t){},"unique":function(t){t.sort();for(var e=[t[0]],n=1;n<t.length;n++)t[n]!==e[e.length-1]&&e.push(t[n]);return e},"getQueryString":function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(e);return null!=n?unescape(n[2]):null}};t.exports={"init":c}}).call(exports,e(0))},"179":function(t,exports,e){var n=e(3);t.exports=n("src/js/page/uploader/toast",function(t,e){"use strict";var n=this,i=(n.$helpers,n.$each),a=t.data,o=(t.v,t.$index,n.$escape),r="";return r+=' <div class="toast-article"> ',i(a,function(t,e){r+=" <p> ",r+=o(t),r+=" </p> "}),r+=" </div> ",new String(r)})},"3":function(t,exports){!function(){function e(t,e){return(/string|function/.test(typeof e)?u:s)(t,e)}function n(t,e){return"string"!=typeof t&&(e=typeof t,"number"===e?t+="":t="function"===e?n(t.call(t)):""),t}function i(t){return m[t]}function a(t){return n(t).replace(/&(?![\w#]+;)|[<>"']/g,i)}function o(t,e){if(d(t))for(var n=0,i=t.length;i>n;n++)e.call(t,t[n],n,t);else for(n in t)e.call(t,t[n],n)}function r(t,e){var n=/(\/)[^\/]+\1\.\.\1/,i=("./"+t).replace(/[^\/]+$/,""),a=i+e;for(a=a.replace(/\/\.\//g,"/");a.match(n);)a=a.replace(n,"/");return a}function s(t,n){var i=e.get(t)||c({"filename":t,"name":"Render Error","message":"Template not found"});return n?i(n):i}function u(t,e){if("string"==typeof e){var n=e;e=function(){return new p(n)}}var i=l[t]=function(n){try{return new e(n,t)+""}catch(t){return c(t)()}};return i.prototype=e.prototype=h,i.toString=function(){return e+""},i}function c(t){var e="{Template Error}",n=t.stack||"";if(n)n=n.split("\n").slice(0,2).join("\n");else for(var i in t)n+="<"+i+">\n"+t[i]+"\n\n";return function(){return"object"==typeof console&&console.error(e+"\n\n"+n),e}}var l=e.cache={},p=this.String,m={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},d=Array.isArray||function(t){return"[object Array]"==={}.toString.call(t)},h=e.utils={"$helpers":{},"$include":function(t,e,n){return t=r(n,t),s(t,e)},"$string":n,"$escape":a,"$each":o},f=e.helpers=h.$helpers;e.get=function(t){return l[t.replace(/^\.\//,"")]},e.helper=function(t,e){f[t]=e},t.exports=e}()},"483":function(t,exports,e){"use strict";(function($){window.TimeStatus=0,window.StatusOnoff=!1,window.upNumber=parseInt(maxNum),window.limitNumber=parseInt(maxNum)-window.upNumber;var t=e(484),n=(e(485),e(177)),i=e(178),a=e(489),o=($(".box-topic"),$(".box-main"),$(".main-list-cube")||null);$(".touch-input-icon"),$(".touch-btn-icon");t.init(window,window.lib||(window.lib={})),t.page(),o&&n.init(o),i.init.initNum(),a.init.getPCStatus(),window.TimeStatus=setInterval(function(){a.init.getPCStatus()},2e3)}).call(exports,e(0))},"484":function(t,exports,e){"use strict";var n=function(t,e){function n(){var e=o.getBoundingClientRect().width,n=e/18.75;o.style.fontSize=n+"px",l.rem=t.rem=n}var i,a=t.document,o=a.documentElement,r=a.querySelector('meta[name="viewport"]'),s=a.querySelector('meta[name="flexible"]'),u=0,c=0,l=e.flexible||(e.flexible={});if(r){console.warn("将根据已有的meta标签来设置缩放比例");var p=r.getAttribute("content").match(/initial\-scale=([\d\.]+)/);p&&(c=parseFloat(p[1]),u=parseInt(1/c))}else if(s){var m=s.getAttribute("content");if(m){var d=m.match(/initial\-dpr=([\d\.]+)/),h=m.match(/maximum\-dpr=([\d\.]+)/);d&&(u=parseFloat(d[1]),c=parseFloat((1/u).toFixed(2))),h&&(u=parseFloat(h[1]),c=parseFloat((1/u).toFixed(2)))}}if(!u&&!c){var f=(t.navigator.appVersion.match(/android/gi),t.navigator.appVersion.match(/iphone/gi)),g=t.devicePixelRatio;u=f?g>=3&&(!u||u>=3)?3:g>=2&&(!u||u>=2)?2:1:1,c=1/u}if(o.setAttribute("data-dpr",u),!r)if(r=a.createElement("meta"),r.setAttribute("name","viewport"),r.setAttribute("content","initial-scale="+c+", maximum-scale="+c+", minimum-scale="+c+", user-scalable=no"),o.firstElementChild)o.firstElementChild.appendChild(r);else{var b=a.createElement("div");b.appendChild(r),a.write(b.innerHTML)}t.addEventListener("resize",function(){clearTimeout(i),i=setTimeout(n,300)},!1),t.addEventListener("pageshow",function(t){t.persisted&&(clearTimeout(i),i=setTimeout(n,300))},!1),"complete"===a.readyState?a.body.style.fontSize=14*u+"px":a.addEventListener("DOMContentLoaded",function(t){a.body.style.fontSize=14*u+"px"},!1),n(),l.dpr=t.dpr=u,l.refreshRem=n,l.rem2px=function(t){var e=parseFloat(t)*this.rem;return"string"==typeof t&&t.match(/rem$/)&&(e+="px"),e},l.px2rem=function(t){var e=parseFloat(t)/this.rem;return"string"==typeof t&&t.match(/px$/)&&(e+="rem"),e}},i=function(){document.body.style.height=(document.body.scrollHeight||document.body.clientHeight)+"px"};t.exports={"init":n,"page":i}},"485":function(t,exports,e){"use strict";!function(){var t="@charset \"utf-8\";html{color:#000;background:#fff;overflow-y:scroll;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}html *{outline:0;-webkit-text-size-adjust:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}html,body{font-family:sans-serif}body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,code,form,fieldset,legend,input,textarea,p,blockquote,th,td,hr,button,article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{margin:0;padding:0}input,select,textarea{font-size:100%}table{border-collapse:collapse;border-spacing:0}fieldset,img{border:0}abbr,acronym{border:0;font-variant:normal}del{text-decoration:line-through}address,caption,cite,code,dfn,em,th,var{font-style:normal;font-weight:500}ol,ul{list-style:none}caption,th{text-align:left}h1,h2,h3,h4,h5,h6{font-size:100%;font-weight:500}q:before,q:after{content:''}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}a:hover{text-decoration:underline}ins,a{text-decoration:none}",e=document.createElement("style");if(document.getElementsByTagName("head")[0].appendChild(e),e.styleSheet)e.styleSheet.disabled||(e.styleSheet.cssText=t);else try{e.innerHTML=t}catch(n){e.innerText=t}}()},"486":function(t,exports,e){var n=e(3);t.exports=n("src/js/page/uploader/upbutton",'<li class="main-list-cube" id="up_icon_wrap"> <i class="cube-up-pic"> <input class="touch-up-pic" type="file" multiple accept="image/jpg,image/jpeg,image/png,image/gif,image/JPEG" id="up_icon_more"> </li> ')},"487":function(t,exports,e){var n=e(3);t.exports=n("src/js/page/uploader/list",function(t,e){"use strict";var n=this,i=(n.$helpers,n.$escape),a=t.data,o="";return o+=' <li class="main-list-cube"> <img class="cube-pic" src="',o+=i(a),o+='"> <div class="cube-mask"> <p>上传中</p> <div class="cube-progress"> <i class="cube-progrss-item"></i> </div> </div> </li>   ',new String(o)})},"488":function(t,exports,e){var n=e(3);t.exports=n("src/js/page/uploader/alert",function(t,e){"use strict";var n=this,i=(n.$helpers,n.$escape),a=t.data,o="";return o+='<div class="alert-box"> <div class="alert-message"> <p class="alert-data"> ',o+=i(a),o+=" </p> </div> </div> ",new String(o)})},"489":function(t,exports,e){"use strict";(function($){var n=e(2),i=e(5),a=(e(178),e(179)),o=$("#up_icon"),r=$(".main-toast"),s={"getPCStatus":function(){n.get(i.get("h5QruploadStatus"),{"data":{"pageId":pageId||window.pageId,"qrcodeId":qrcodeId||window.qrcodeId}}).done(function(t){t.success&&("1"==t.data.page&&"1"==t.data.qrcode?t.data.qrcodetime||window.StatusOnoff||(clearInterval(window.TimeStatus),o.attr("disabled",!0),$("#up_icon_more").attr("disabled",!0),r.append(a({"data":["二维码已失效请重新扫描"]}))):"2"==t.data.page||"2"==t.data.qrcode||"500"==t.code?(clearInterval(window.TimeStatus),o.attr("disabled",!0),$("#up_icon_more").attr("disabled",!0),r.append(a({"data":["二维码已失效，请重新扫描后上传"]}))):clearInterval(window.TimeStatus))}).fail(function(t){console.error(t)})}};t.exports={"init":s}}).call(exports,e(0))}},[483]);